
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data-driven dimension reduction in turbomachinery &#8212; Documentation | equadratures</title>
    
    <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/styles.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/footer.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/fonts.css" />
    
    <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="shortcut icon" href="../../_static/eq-logo-favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Machine learning of airfoil self-noise with interpretable polynomial trees" href="Machine_Learning_Airfoil.html" />
    <link rel="prev" title="A primer on data-driven dimension reduction" href="Dimension_Reduction.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/logo_new.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../core/index.html">
  Core classes
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../secondary/index.html">
  Secondary classes
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../theory/index.html">
  Theory
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../index.html">
  Tutorials
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search documentation" aria-label="Search documentation" autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Foundations
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="1_Defining_a_Parameter.html">
   Foundations I: Parameter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2_Orthogonal_Polynomials.html">
   Foundations II: Orthogonal polynomials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3_Model_Fitting.html">
   Foundations III: Solving linear systems for model fitting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Object_Persistence.html">
   Persistence of equadratures objects
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Uncertainty quantification and sensitivity analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Computing_Moments_for_CFD.html">
   Uncertainty quantification of CFD simulations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Sensitivity_Analysis_Probe.html">
   Sensitivity analysis for a piston model
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Dimension reduction
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Dimension_Reduction.html">
   A primer on data-driven dimension reduction
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Data-driven dimension reduction in turbomachinery
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Advanced applications
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Machine_Learning_Airfoil.html">
   Machine learning of airfoil self-noise with interpretable polynomial trees
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Load-the-data">
   Load the data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Find-a-1D-subspace-for-loss-coefficient">
   Find a 1D subspace for loss coefficient
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Find-a-2D-subspace-for-the-recovery-ratio-gradient">
   Find a 2D subspace for the recovery ratio gradient
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Data-driven-dimension-reduction-in-turbomachinery">
<h1>Data-driven dimension reduction in turbomachinery<a class="headerlink" href="#Data-driven-dimension-reduction-in-turbomachinery" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, we will look at some of the material in this <a class="reference external" href="http://dx.doi.org/10.1115/GT2020-16277">ASME Turbo Expo paper</a>, which explores the design of a probe used to measure the stagnation temperature in gas-turbine engines. By using <em>equadratures</em> to reduce the dimensionality of the design space, the probes’ performance parameters can be more effectively visualised, and physical insights obtained.</p>
<div class="section" id="Load-the-data">
<h2>Load the data<a class="headerlink" href="#Load-the-data" title="Permalink to this headline">¶</a></h2>
<p>The data consists of Computational Fluid Dynamics (CFD) simulations of <span class="math notranslate nohighlight">\(N=128\)</span> temperature probes, with the upper half of one shown below. The probe geometries are parameterised by <span class="math notranslate nohighlight">\(d=7\)</span> design parameters, with the design space sampled using Latin Hypercube sampling.</p>
<p><img alt="drawing" src="../../_images/probe.jpeg" /></p>
<p>The input design vectors are stored in <span class="math notranslate nohighlight">\(\mathbf{X}\in \mathbb{R}^{N\times d}\)</span>, and two design objectives <span class="math notranslate nohighlight">\(y_1,y_2 \in \mathbb{R}^{N \times 1}\)</span> are considered. We wish to minimise both of these objectives, which represent the following (see Sections 2 and 6 in the paper for more details):</p>
<ol class="arabic simple">
<li><p><span class="math notranslate nohighlight">\(y_1\)</span>: Stagnation pressure loss coefficient <span class="math notranslate nohighlight">\(Y_p\)</span> averaged across the Mach number range.</p></li>
<li><p><span class="math notranslate nohighlight">\(y_2\)</span>: Gradient of recovery ratio w.r.t to Mach number <span class="math notranslate nohighlight">\(\partial R_r/\partial M\)</span>.</p></li>
</ol>
<p>The data can be downloaded from the <a class="reference external" href="https://github.com/equadratures/data-sets">equadratures dataset repo</a> using the <code class="docutils literal notranslate"><span class="pre">datasets.load_eq_dataset</span></code> method. As in the paper, <span class="math notranslate nohighlight">\(X\)</span> is standardised to lie within the interval <span class="math notranslate nohighlight">\([-1,1]\)</span>. Unlike in the paper, for commerical privacy reasons, <span class="math notranslate nohighlight">\(y_1\)</span>, <span class="math notranslate nohighlight">\(y_2\)</span> are also standardised here.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>In [31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">equadratures</span> <span class="k">as</span> <span class="nn">eq</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">load_eq_dataset</span><span class="p">(</span><span class="s1">&#39;probes&#39;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">X</span>  <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;y1&#39;</span><span class="p">]</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;y2&#39;</span><span class="p">]</span>
<span class="n">design_params</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Hole $\oslash$&#39;</span><span class="p">,</span><span class="s1">&#39;Kiel $\oslash_</span><span class="si">{inner}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="s1">&#39;Kiel $\oslash_</span><span class="si">{outer}</span><span class="s1">$&#39;</span><span class="p">,</span>\
           <span class="s1">&#39;Kiel lip fwd/back&#39;</span><span class="p">,</span><span class="s1">&#39;Hole angle&#39;</span><span class="p">,</span><span class="s1">&#39;Hole fwd/back&#39;</span><span class="p">,</span><span class="s1">&#39;Hole ellipse&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Downloading the probes dataset from github...
</pre></div></div>
</div>
</div>
<div class="section" id="Find-a-1D-subspace-for-loss-coefficient">
<h2>Find a 1D subspace for loss coefficient<a class="headerlink" href="#Find-a-1D-subspace-for-loss-coefficient" title="Permalink to this headline">¶</a></h2>
<p>Here we find a subspace for the loss coefficient design objective <span class="math notranslate nohighlight">\(y_1\)</span> (<span class="math notranslate nohighlight">\(O_{Yp}\)</span> in the paper). From a <a class="reference external" href="https://github.com/ascillitoe/probe-subspaces/blob/main/Example_Notebooks/grid_search.ipynb">previous grid search</a>, we know a 1D subspace (<span class="math notranslate nohighlight">\(m=1\)</span>) and <span class="math notranslate nohighlight">\(1^{st}\)</span> order polynomial (<span class="math notranslate nohighlight">\(k=1\)</span>) are suitable.</p>
<p>The subspace procedure is not deterministic (there is an element of randomness involved). Sometimes poor subspaces are obtained. We can judge by looking at <span class="math notranslate nohighlight">\(R^2\)</span> or simply plotting the summary plot (see later). In this event we simply rerun until we find a subspace we are happy with. This does mean that it is good practice to save a subspace to file for future analysis, instead of generating a new one each time.</p>
<p>You can save a subspace with <code class="docutils literal notranslate"><span class="pre">joblib.dump(mysubspace1,'Yp_subspace.joblib')</span></code> for example.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>In [45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m1</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># number of reduced dimensions</span>
<span class="n">k1</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># polynomial order</span>

<span class="c1"># Find subspace via variable projection</span>
<span class="n">mysubspace1</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">Subspaces</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;variable-projection&#39;</span><span class="p">,</span><span class="n">sample_points</span><span class="o">=</span><span class="n">X</span><span class="p">,</span>\
                        <span class="n">sample_outputs</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span><span class="n">polynomial_degree</span><span class="o">=</span><span class="n">k1</span><span class="p">,</span> <span class="n">subspace_dimension</span><span class="o">=</span><span class="n">m1</span><span class="p">)</span>

<span class="c1"># Get the subspace vector, and the polynomial approximation</span>
<span class="n">W1</span> <span class="o">=</span> <span class="n">mysubspace1</span><span class="o">.</span><span class="n">get_subspace</span><span class="p">()[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">m1</span><span class="p">]</span>
<span class="n">u1</span> <span class="o">=</span> <span class="n">X</span> <span class="o">@</span> <span class="n">W1</span>
<span class="n">subpoly1</span> <span class="o">=</span> <span class="n">mysubspace1</span><span class="o">.</span><span class="n">get_subspace_polynomial</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>It is good practice to check the accuracy of the subspace (we use adjusted <span class="math notranslate nohighlight">\(R^2\)</span> here), and also visualise its predictions.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>In [46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">subpoly1</span><span class="o">.</span><span class="n">plot_model_vs_data</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_tutorials_Dimension_Reduction_Turbomachinery_7_0.png" src="../../_images/tutorials_tutorials_Dimension_Reduction_Turbomachinery_7_0.png" />
</div>
</div>
<p>If we are happy with the quality of the obtained subspace, we can go ahead and generate a <em>sufficient summary plot</em> - a plot which sufficiently describes the variation in the QoI.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>In [47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mysubspace1</span><span class="o">.</span><span class="n">plot_sufficient_summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_tutorials_Dimension_Reduction_Turbomachinery_9_0.png" src="../../_images/tutorials_tutorials_Dimension_Reduction_Turbomachinery_9_0.png" />
</div>
</div>
<p>Here we have obtained a one-dimensional subspace <span class="math notranslate nohighlight">\(u=\mathbf{W}^T\mathbf{x}\)</span>, which effectively describes the variation in <span class="math notranslate nohighlight">\(y\)</span> (the <span class="math notranslate nohighlight">\(O_{Y_p}\)</span> design objective). As seen above, this is much easier to visualise than the original seven dimensional design space.</p>
<p>This ease of visualisation brings with it a more intuitive understanding of the design space. We can observe how designs compare to others in the design space, and look at how to improve designs. To obtain better designs, we need to minimise the loss design objective <span class="math notranslate nohighlight">\(O_{Y_p}\)</span>. Examining the <span class="math notranslate nohighlight">\(\mathbf{W}\)</span> matrix (or vector in this case) reveals how the design must be altered in order to move around the sufficient summary plot (i.e. increase or decrease
<span class="math notranslate nohighlight">\(u=\mathbf{W}^T\mathbf{x}\)</span>).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>In [48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Components of $\mathbf</span><span class="si">{W}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">W1</span><span class="p">)),</span><span class="n">W1</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span><span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">W1</span><span class="p">)))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">design_params</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span><span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_tutorials_Dimension_Reduction_Turbomachinery_11_0.png" src="../../_images/tutorials_tutorials_Dimension_Reduction_Turbomachinery_11_0.png" />
</div>
</div>
<p>So it is apparent that the Kiel outer diameter has the greatest influence on <span class="math notranslate nohighlight">\(u\)</span>, and therefore on <span class="math notranslate nohighlight">\(O_{Y_p}\)</span>, followed by the hole diameter. A decrease in these two diameters leads to a reduction in the loss <span class="math notranslate nohighlight">\(O_{Y_p}\)</span>.</p>
</div>
<div class="section" id="Find-a-2D-subspace-for-the-recovery-ratio-gradient">
<h2>Find a 2D subspace for the recovery ratio gradient<a class="headerlink" href="#Find-a-2D-subspace-for-the-recovery-ratio-gradient" title="Permalink to this headline">¶</a></h2>
<p>Here we find a subspace for the recovery ratio gradient design objective <span class="math notranslate nohighlight">\(y_2\)</span> (<span class="math notranslate nohighlight">\(O_{Rr}\)</span> in the paper). From a previous grid search, we know a 2D subspace (<span class="math notranslate nohighlight">\(m=2\)</span>) and <span class="math notranslate nohighlight">\(3^{rd}\)</span> order polynomial (<span class="math notranslate nohighlight">\(k=3\)</span>) are suitable.</p>
<p><strong>Note:</strong> This one is trickier! You might need to rerun it a few times to get a good <span class="math notranslate nohighlight">\(R^2\)</span> value.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>In [41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m2</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># number of reduced dimensions</span>
<span class="n">k2</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># polynomial order</span>

<span class="c1"># Find subspace via variable projection</span>
<span class="n">mysubspace2</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">Subspaces</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;variable-projection&#39;</span><span class="p">,</span><span class="n">sample_points</span><span class="o">=</span><span class="n">X</span><span class="p">,</span>\
                        <span class="n">sample_outputs</span><span class="o">=</span><span class="n">y2</span><span class="p">,</span><span class="n">polynomial_degree</span><span class="o">=</span><span class="n">k2</span><span class="p">,</span> <span class="n">subspace_dimension</span><span class="o">=</span><span class="n">m2</span><span class="p">)</span>

<span class="c1"># Get the subspace vector, and the polynomial approximation</span>
<span class="n">W2</span> <span class="o">=</span> <span class="n">mysubspace2</span><span class="o">.</span><span class="n">get_subspace</span><span class="p">()</span>
<span class="n">active_subspace2</span> <span class="o">=</span> <span class="n">W2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">m2</span><span class="p">]</span>
<span class="n">u2</span> <span class="o">=</span> <span class="n">X</span> <span class="o">@</span> <span class="n">active_subspace2</span>
<span class="n">subpoly2</span> <span class="o">=</span> <span class="n">mysubspace2</span><span class="o">.</span><span class="n">get_subspace_polynomial</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>In [42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">subpoly2</span><span class="o">.</span><span class="n">plot_model_vs_data</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_tutorials_Dimension_Reduction_Turbomachinery_15_0.png" src="../../_images/tutorials_tutorials_Dimension_Reduction_Turbomachinery_15_0.png" />
</div>
</div>
<p>Now generate a <em>sufficient summary plot</em> again. This time a 2D one!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>In [43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$u_{R,1}$&#39;</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$u_{R,2}$&#39;</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;$O_</span><span class="si">{R_r}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">zaxis</span><span class="o">.</span><span class="n">set_rotate_label</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">azim</span><span class="o">=-</span><span class="mi">5</span><span class="p">)</span>
<span class="n">mysubspace2</span><span class="o">.</span><span class="n">plot_sufficient_summary</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_tutorials_Dimension_Reduction_Turbomachinery_17_0.png" src="../../_images/tutorials_tutorials_Dimension_Reduction_Turbomachinery_17_0.png" />
</div>
</div>
<p>Similarly to how the weights of <span class="math notranslate nohighlight">\(\mathbf{W}\)</span> were examined to discover designs with lower <span class="math notranslate nohighlight">\(O_{Y_p}\)</span>, this 2D summary plot can be used to discover designs with lower <span class="math notranslate nohighlight">\(O_{R_r}\)</span>. In the <a class="reference external" href="http://dx.doi.org/10.1115/GT2020-16277">ASME Turbo Expo paper</a>, we show how the two subspaces can be used together to explore new areas of the design space where <span class="math notranslate nohighlight">\(O_{Y_p}\)</span> and <span class="math notranslate nohighlight">\(O_{R_r}\)</span> are minimised together. Following this, a third subspace is used to find designs with lower
sensitivity to manufacturing uncertainties.</p>
</div>
</div>


              </div>
              
              
          </main>
          

      </div>
    </div>
  
    <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="footer.css" rel="stylesheet">
</head>
<div class="footer">
             <div class="container">
                 <div class="row">
                   <div class="col-md-6 col-lg-3">
                       <div class="footer-about">
                            <a href="https://equadratures.org/"><img style="float: left; margin: 0px 250px 2px 10px; width:30%; min-width:25px" src="https://equadratures.org/icons/logo.png" alt="Image"></a><br>
                            <b>equadratures</b> <br>
                            mail@equadratures.org<br>
                       </div>
                   </div>
                   <div class="col-md-6 col-lg-3">
                       <div class="footer-social">
                           <a href="https://github.com/equadratures"><img alt="" src="https://equadratures.org/icons/github.png" hspace="0x" style="width:100%; min-width:25px"></a>
                           <a href="https://www.linkedin.com/company/67900612"><img alt=""  src="https://equadratures.org/icons/linkedin.png" hspace="0x" style="width:100%; min-width:25px"></a>
                          <a href="https://twitter.com/equadratures"><img alt="" src="https://equadratures.org/icons/twitter.png" hspace="0x" style="width:100%; min-width:25px"></a>
                        <a href="https://www.youtube.com/channel/UCpjwFDSZuFbzW-2lj6d96dA"><img alt="" src="https://equadratures.org/icons/youtube.png" hspace="0x" style="width:100%; min-width:25px"></a>
                       </div>
                       <br>
                       <br>
                   </div>
                   <div class="col-md-6 col-lg-3">
                       <div class="footer-contact">
                         <b>management </b><br>
                         <a href="https://equadratures.org/team">team </a><br>
                         <a href="https://equadratures.org/partnerships">partnerships</a> <br>
                         <a href="https://equadratures.org/case-studies">case studies</a> <br>
                         <a href="https://research.equadratures.org/">research</a><br>
                       </div>
                   </div>
                     <div class="col-md-6 col-lg-3">
                         <div class="footer-links">
                             <b>code </b><br>
                             <a href="https://equadratures.org/documentation">documentation</a><br>
                             <a href="https://discourse.equadratures.org/">discourse</a><br>
                             <a href="https://equadratures.org/numfocus">numfocus affiliation</a> <br>
                             <a href="https://equadratures.org/gsoc">google summer of code</a> <br>
                         </div>
                     </div>
                 </div>
             </div>
             <center>
               <div class="smallerr">
               copyright &copy; 2022 by equadratures.
               <br>
               made by the equadratures team, with &#10084;&#65039;.
             </div>
               <br>
               <br>
             </center>
         </div>
  </body>
</html>